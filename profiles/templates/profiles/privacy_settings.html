{% extends 'base.html' %}

{% block title %}Privacy Settings - LockedIn{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-lg-10 mx-auto">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2><i class="fas fa-lock me-2"></i>Privacy Settings</h2>
                    <p class="text-muted">Control what recruiters can see about you</p>
                </div>
                <a href="{% url 'preview_profile' %}" class="btn btn-outline-primary" target="_blank">
                    <i class="fas fa-eye me-1"></i>Preview as Recruiter
                </a>
            </div>

            <form method="post" id="privacyForm">
                {% csrf_token %}

                <!-- Privacy Level Presets -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-sliders-h me-2"></i>Quick Privacy Presets</h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Choose a preset to quickly configure your privacy settings, or customize manually below.</p>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="card preset-card h-100 {% if privacy_settings.privacy_level == 'public' %}border-primary{% endif %}" onclick="applyPreset('public')">
                                    <div class="card-body text-center">
                                        <i class="fas fa-globe fa-3x text-success mb-3"></i>
                                        <h5>Public</h5>
                                        <p class="small text-muted">Everything visible to all recruiters</p>
                                        <span class="badge bg-success">Click to Apply</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card preset-card h-100 {% if privacy_settings.privacy_level == 'limited' %}border-primary{% endif %}" onclick="applyPreset('limited')">
                                    <div class="card-body text-center">
                                        <i class="fas fa-shield-alt fa-3x text-warning mb-3"></i>
                                        <h5>Limited</h5>
                                        <p class="small text-muted">Basic info visible, contact hidden</p>
                                        <span class="badge bg-warning text-dark">Click to Apply</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card preset-card h-100 {% if privacy_settings.privacy_level == 'private' %}border-primary{% endif %}" onclick="applyPreset('private')">
                                    <div class="card-body text-center">
                                        <i class="fas fa-user-secret fa-3x text-danger mb-3"></i>
                                        <h5>Private</h5>
                                        <p class="small text-muted">Minimal visibility, anonymous mode</p>
                                        <span class="badge bg-danger">Click to Apply</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden form for preset submission -->
                        <input type="hidden" name="apply_preset" id="apply_preset" value="">
                        <input type="hidden" name="privacy_level_preset" id="privacy_level_preset" value="">
                        <div class="mt-3">
                            <small class="text-info">
                                <i class="fas fa-info-circle me-1"></i>
                                Current Level: <strong>{{ privacy_settings.get_privacy_level_display }}</strong>
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Basic Information Privacy -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="fas fa-user me-2"></i>Basic Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.show_full_name }}
                                    <label class="form-check-label" for="{{ form.show_full_name.id_for_label }}">
                                        Show Full Name
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.show_profile_photo }}
                                    <label class="form-check-label" for="{{ form.show_profile_photo.id_for_label }}">
                                        Show Profile Photo
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.show_email }}
                                    <label class="form-check-label" for="{{ form.show_email.id_for_label }}">
                                        Show Email Address
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.show_phone }}
                                    <label class="form-check-label" for="{{ form.show_phone.id_for_label }}">
                                        Show Phone Number
                                    </label>
                                </div>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="{{ form.location_visibility.id_for_label }}" class="form-label">
                                    Location Visibility
                                </label>
                                {{ form.location_visibility }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Professional Information Privacy -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="fas fa-briefcase me-2"></i>Professional Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.show_current_employer }}
                                    <label class="form-check-label" for="{{ form.show_current_employer.id_for_label }}">
                                        Show Current Employer
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.work_history_visibility.id_for_label }}" class="form-label">
                                    Work History Visibility
                                </label>
                                {{ form.work_history_visibility }}
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.show_education }}
                                    <label class="form-check-label" for="{{ form.show_education.id_for_label }}">
                                        Show Education
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.show_skills }}
                                    <label class="form-check-label" for="{{ form.show_skills.id_for_label }}">
                                        Show Skills & Certifications
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.show_resume }}
                                    <label class="form-check-label" for="{{ form.show_resume.id_for_label }}">
                                        Allow Resume Downloads
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Additional Settings -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="fas fa-cog me-2"></i>Additional Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.searchable_by_recruiters }}
                                    <label class="form-check-label" for="{{ form.searchable_by_recruiters.id_for_label }}">
                                        Make Profile Searchable by Recruiters
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.allow_recruiter_messages }}
                                    <label class="form-check-label" for="{{ form.allow_recruiter_messages.id_for_label }}">
                                        Allow Recruiters to Message Me
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.show_salary_expectations }}
                                    <label class="form-check-label" for="{{ form.show_salary_expectations.id_for_label }}">
                                        Show Salary Expectations
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.notify_on_profile_view }}
                                    <label class="form-check-label" for="{{ form.notify_on_profile_view.id_for_label }}">
                                        Email Notifications When Profile is Viewed
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Blocked Companies -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="fas fa-ban me-2"></i>Block Specific Companies</h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted small">Hide your profile from specific companies (useful for hiding from current employer)</p>
                        <label for="{{ form.blocked_companies.id_for_label }}" class="form-label">
                            Blocked Companies
                        </label>
                        {{ form.blocked_companies }}
                        <small class="form-text text-muted">
                            Separate company names with commas
                        </small>
                    </div>
                </div>

                <!-- Anonymous Mode -->
                <div class="card mb-4 shadow-sm border-warning">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-user-secret me-2"></i>Anonymous Mode</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check">
                            {{ form.anonymous_mode }}
                            <label class="form-check-label" for="{{ form.anonymous_mode.id_for_label }}">
                                Enable Anonymous Mode
                            </label>
                        </div>
                        <small class="text-muted">
                            When enabled, only your skills, experience level, and education are visible.
                            Your name, photo, contact info, and company names are hidden until you accept a connection.
                        </small>
                    </div>
                </div>

                <!-- Hidden privacy_level field -->
                <input type="hidden" name="privacy_level" value="{{ form.privacy_level.value }}">

                <!-- Action Buttons -->
                <div class="d-flex justify-content-between align-items-center">
                    <a href="{% url 'view_profile' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-times me-1"></i>Cancel
                    </a>
                    <div>
                        <a href="{% url 'preview_profile' %}" class="btn btn-outline-info me-2" target="_blank">
                            <i class="fas fa-eye me-1"></i>Preview
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>Save Privacy Settings
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.preset-card {
    transition: all 0.3s ease;
    cursor: pointer;
}

.preset-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.preset-card.border-primary {
    border-width: 3px !important;
}

.card {
    border-radius: 10px;
}

.card-header {
    border-radius: 10px 10px 0 0 !important;
}
</style>

<script>
// Apply preset by clicking anywhere on the card
function applyPreset(preset) {
    if (confirm(`Apply ${preset.charAt(0).toUpperCase() + preset.slice(1)} privacy preset?\n\nThis will update all your privacy settings.`)) {
        document.getElementById('apply_preset').value = preset;
        document.querySelector('input[name="privacy_level"]').value = preset;
        document.getElementById('privacyForm').submit();
    }
}

// Mark privacy level as custom when any field is manually changed
document.querySelectorAll('input[type="checkbox"], select:not(#privacyLevelSelect)').forEach(element => {
    element.addEventListener('change', function() {
        // Set privacy level to custom if user manually changes settings
        document.querySelector('input[name="privacy_level"]').value = 'custom';
    });
});
</script>
{% endblock %}
